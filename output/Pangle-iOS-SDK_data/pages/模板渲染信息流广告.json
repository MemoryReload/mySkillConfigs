{
  "url": "https://www.csjplatform.com/supportcenter/5384",
  "title": "模板渲染信息流广告",
  "content": "开发测试/iOS集成文档/模板渲染信息流广告\n模板渲染信息流广告\n最近更新 2025-10-11 16:16:46\n简介\n\n模板渲染信息流：场景应在应用的内容流中与应用内容穿插展示，广告内容与应用其他内容区分开，防止意外点击。\n\n支持的广告尺寸：开发者在穿山甲平台上可以进行多模板、多尺寸的勾选。模板渲染信息流广告支持开发者调整、编辑\n\n权限\n\n模版渲染信息流广告： 默认提供\n\n使用说明\n\n模版信息流广告使用BUNativeExpressAdManager对象调用loadAd请求广告，使用BUNativeExpressAdView对象来进行广告的渲染render，通过设置BUNativeExpressAdViewDelegate代理，获取广告、展示、点击、关闭等回调。\n\n创建广告位对象、请求广告\n\nBUNativeExpressAdManager\n\n请求广告时需要传入广告位对象，广告位对象创建时必须传入广告位ID\n\n字段定义\n\n\t\n\n是否必传\n\n\t\n\n字段名称\n\n\t\n\n字段类型\n\n\t\n\n备注\n\n\n\n\nBUAdSlot\n\n\t\n\n是\n\n\t\n\n/\n\n\t\n\n/\n\n\t\n\n基本信息配置，详见事例\n\n\n\n\nadSize\n\n\t\n\n是\n\n\t\n\n广告尺寸\n\n\t\n\nCGSize\n\n\t\n\n广告尺寸，可将宽度设置为屏宽，自适应时，可将高度直接设置为0\n\n请求广告前需要配置BUAdSlot广告的基本信息，使用BUNativeExpressAdManager创建对象，使用BUNativeExpressAdManager调用loadAd请求广告\n\n复制\n//保证每次请求的广告对象为新的广告对象，避免重复使用广告同一个对象进行广告请求\nBUAdSlot *slot1 = [[BUAdSlot alloc] init];\nslot1.ID = self.viewModel.slotID;\nslot1.AdType = BUAdSlotAdTypeFeed;\nBUSize *imgSize = [BUSize sizeBy:BUProposalSize_Feed228_150];\nslot1.imgSize = imgSize;\nslot1.position = BUAdSlotPositionFeed;\n// self.nativeExpressAdManager可以重用\n if (!self.nativeExpressAdManager) {\n    self.nativeExpressAdManager = [[BUNativeExpressAdManager alloc] initWithSlot:slot1 adSize:CGSizeMake(self.widthSlider.value, self.heightSlider.value)];\n   }\nself.nativeExpressAdManager.adSize = CGSizeMake(self.widthSlider.value, self.heightSlider.value);\nself.nativeExpressAdManager.delegate = self;\nNSInteger count = (NSInteger)self.adCountSlider.value;\n[self.nativeExpressAdManager loadAdDataWithCount:count];\n\n注意：\n\nself.nativeExpressAdManager可以重用\n模版信息流的尺寸adSize建议宽度设置为屏宽 高度设置为0或者设置平台勾选的高度 不要随意设置尺寸大小否则有可能出现拉取失败或者广告变形的情况\n模版信息流广告可多条广告同时请求，最大请求数量为3\n模版信息流广告默认设置imgSize为BUProposalSize_Feed228_150即可\n展示广告\n\n由于官方Demo使用tableView进行的广告的插入展示，直接更新数据源即可更新广告的相关插入展示，此处建议开发者在收到nativeExpressAdSuccessToLoad回调后再进行广告的渲染展示，可保证播放流畅和展示流畅，用户体验更好。因此如果不是使用此种方式进行的信息流广告的展示，切记不要忘记addSubview添加广告对象来进行广告的展示。\n\n展示时机\n\n在收到nativeExpressAdSuccessToLoad回调后再进行广告的渲染展示，刷新数据源\n\n复制\n- (void)nativeExpressAdSuccessToLoad:(BUNativeExpressAdManager *)nativeExpressAd views:(NSArray<__kindof BUNativeExpressAdView *> *)views {\n   [self.expressAdViews removeAllObjects];//【重要】不能保存太多view，需要在合适的时机手动释放不用的，否则内存会过大\n    if (views.count) {\n       [self.expressAdViews addObjectsFromArray:views];\n       [views enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {\n           BUNativeExpressAdView *expressView = (BUNativeExpressAdView *)obj;\n           expressView.rootViewController = self;\n           // important: 此处会进行WKWebview的渲染，建议一次最多预加载三个广告，如果超过3个会很大概率导致WKWebview渲染失败。\n          [expressView render];\n       }];\n   }\n   [self.tableView reloadData];\n}\n\n注意：为了避免内存过大触发系统优化机制，建议在合适的时机进行remove移除操作，目前SDK使用WKWebView实现，此建议不限于模版信息流广告，其他广告同样适用，保证不使用的广告，在合适的时机进行释放处理\n\n接收广告加载结果\n\nBUNativeExpressAdViewDelegate回调说明\n\n回调方法\n\n\t\n\n注释\n\n\n\n\nnativeExpressAdFailToLoad\n\n\t\n\n返回的错误码(error)表示广告加载失败的原因，所有错误码详情请见链接。Link\n\n\n\n\nnativeExpressAdViewRenderFail\n\n\t\n\n渲染失败，网络原因或者硬件原因导致渲染失败,可以更换手机或者网络环境测试。建议升级到穿山甲平台最新版本\n\n\n\n\nnativeExpressAdSuccessToLoad\n\n\t\n\n广告视图加载成功\n\n\n\n\nnativeExpressAdViewRenderSuccess\n\n\t\n\n渲染成功\n\n通过设置BUNativeExpressAdViewDelegate代理，获取广告、展示、点击、关闭等回调。其他代理方法可参见Demo中BUDExpressFeedViewController类#pragma mark - BUNativeExpressAdViewDelegate部分\n\n\n\n\nBUVideoAdViewDelegate回调说明\n\n回调方法\n\n\t\n\n注释\n\n\n\n\ndidLoadFailWithError:\n\n\t\n\n播放失败时调用\n\n\n\n\nplayerReadyToPlay:\n\n\t\n\n准备播放时调用\n\n\n\n\nstateDidChanged:\n\n\t\n\n回放状态改变时调用\n\n\n\n\nrewardDidCountDown:\n\n\t\n\n当奖励视频奖励开始倒计时调用，5.0.0.0及以上版本新增\n\n\n\n\nplayerDidPlayFinish:\n\n\t\n\n播放结束时调用\n\n\n\n\nvideoAdViewDidClick:\n\n\t\n\n点击时调用\n\n\n\n\nvideoAdViewFinishViewDidClick:\n\n\t\n\n播放完成被点击时调用\n\n\n\n\nvideoAdViewDidCloseOtherController:\n\n\t\n\n在app中打开appstore或打开网页或查看视频广告详情页面\n\n激励信息流代理方法BUVideoAdViewDelegate新增奖励倒计时回调接口：\n\n复制\n/**\n This method is called when the countdown of reward video rewards starts\n @param countDown : countdown of reward video rewards\n */\n- (void)videoAdView:(BUVideoAdView *)videoAdView\n rewardDidCountDown:(NSInteger)countDown;\ndislike回调说明\n复制\n- (void)nativeExpressAdView:(BUNativeExpressAdView *)nativeExpressAdView dislikeWithReason:(NSArray<BUDislikeWords *> *)filterWords {\n    //【重要】需要在点击叉以后 在这个回调中移除视图，否则，会出现用户点击叉无效的情况\n   [self.expressAdViews removeObject:nativeExpressAdView];\n    NSUInteger index = [self.expressAdViews indexOfObject:nativeExpressAdView];\n    NSIndexPath *indexPath=[NSIndexPath indexPathForRow:index inSection:0];\n   [self.tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationFade]; \n}\n\n- (void)nativeExpressAdViewDidRemoved:(BUNativeExpressAdView *)nativeExpressAdView {\n//【重要】若开发者收到此回调，代表穿山甲会主动关闭掉广告，广告移除后需要开发者对界面进行适配\n  NSUInteger index = [self.expressAdViews indexOfObject:nativeExpressAdView];\n  [self.expressAdViews removeObject:nativeExpressAdView];\n  NSIndexPath *indexPath=[NSIndexPath indexPathForRow:index inSection:0];\n  NSIndexPath *placeholderIndexPath = [NSIndexPath indexPathForRow:index + 1 inSection:0];\n  [self.tableView deleteRowsAtIndexPaths:@[indexPath, placeholderIndexPath] withRowAnimation:UITableViewRowAnimationFade];\n}\n\n注意：\n\n切记不要忘记设置BUNativeExpressAdView对象的rootViewController，保证当前传入的rootViewController不为空，并确保self.nativeExpressAdManager进行了重用判断，否则有可能出现偶现dislike回调方法不进的异常场景\n\nBUMaterialMeta.h\n\n广告推荐说明dislike功能下 “为什么看到此广告”模块，相关API在5.1.0.0及之后版本会完全下掉\n\n复制\n/// compliance statement of personalized advertising push\n@property (nonatomic, strong) BUPersonalizationPrompts *personalPrompts DEPRECATED_MSG_ATTRIBUTE(\"The 'personalPrompts' api will not work and will be removed in the future.\");\n\nBUAdSlot.h\n\nisOriginAd只有banner广告需要设置YES（5.1.0.0及后续版本）\n\n复制\n/// Banner ads are set to YES, other ad types are 0, the default is NO.\n@property (nonatomic, assign) BOOL isOriginAd DEPRECATED_MSG_ATTRIBUTE(\"The 'isOriginAd's is only valid for Banner Ads, no longer required in version 5.1.0.0 and later.\");\n\n注意事项\n\n①self.nativeExpressAdManager可以重用\n\n②模版信息流的尺寸adSize建议宽度设置为屏宽 高度设置为0或者设置平台勾选的高度 不要随意设置尺寸大小否则有可能出现拉取失败或者广告变形的情况\n\n③为了避免内存过大触发系统优化机制，建议在合适的时机进行remove移除操作\n\n④不要忘记设置BUNativeExpressAdView对象的rootViewController，保证当前传入的rootViewController不为空\n\n资源\n\n详细接入可参照Demo中的BUDExpressFeedViewController类，广告加载请求部分可参照loadData方法，广告展示渲染部分可参照nativeExpressAdSuccessToLoad方法\n\n\n\n\n\n\n\n本篇目录\n简介\n权限\n使用说明\n创建广告位对象、请求广告\n展示广告\n展示时机\n接收广告加载结果\ndislike回调说明\n注意事项\n资源\n评价此篇文档\n有帮助\n无帮助"
}