{
  "title": "Use with Claude",
  "content": "options = ClaudeAgentOptions(\n    mcp_servers={\"calc\": calculator},\n    allowed_tools=[\"mcp__calc__add\", \"mcp__calc__multiply\"]\n)\npython\nclass ClaudeSDKClient:\n    def __init__(self, options: ClaudeAgentOptions | None = None)\n    async def connect(self, prompt: str | AsyncIterable[dict] | None = None) -> None\n    async def query(self, prompt: str | AsyncIterable[dict], session_id: str = \"default\") -> None\n    async def receive_messages(self) -> AsyncIterator[Message]\n    async def receive_response(self) -> AsyncIterator[Message]\n    async def interrupt(self) -> None\n    async def rewind_files(self, user_message_uuid: str) -> None\n    async def disconnect(self) -> None\npython\nasync with ClaudeSDKClient() as client:\n    await client.query(\"Hello Claude\")\n    async for message in client.receive_response():\n        print(message)\npython\nimport asyncio\nfrom claude_agent_sdk import ClaudeSDKClient, AssistantMessage, TextBlock, ResultMessage\n\nasync def main():\n    async with ClaudeSDKClient() as client:\n        # First question\n        await client.query(\"What's the capital of France?\")\n\n# Process response\n        async for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\n# Follow-up question - Claude remembers the previous context\n        await client.query(\"What's the population of that city?\")\n\nasync for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\n# Another follow-up - still in the same conversation\n        await client.query(\"What are some famous landmarks there?\")\n\nasync for message in client.receive_response():\n            if isinstance(message, AssistantMessage):\n                for block in message.content:\n                    if isinstance(block, TextBlock):\n                        print(f\"Claude: {block.text}\")\n\nasyncio.run(main())\npython\nimport asyncio\nfrom claude_agent_sdk import ClaudeSDKClient\n\nasync def message_stream():\n    \"\"\"Generate messages dynamically.\"\"\"\n    yield {\"type\": \"text\", \"text\": \"Analyze the following data:\"}\n    await asyncio.sleep(0.5)\n    yield {\"type\": \"text\", \"text\": \"Temperature: 25Â°C\"}\n    await asyncio.sleep(0.5)\n    yield {\"type\": \"text\", \"text\": \"Humidity: 60%\"}\n    await asyncio.sleep(0.5)\n    yield {\"type\": \"text\", \"text\": \"What patterns do you see?\"}\n\nasync def main():\n    async with ClaudeSDKClient() as client:\n        # Stream input to Claude\n        await client.query(message_stream())\n\n# Process response\n        async for message in client.receive_response():\n            print(message)\n\n# Follow-up in same session\n        await client.query(\"Should we be concerned about these readings?\")\n\nasync for message in client.receive_response():\n            print(message)\n\nasyncio.run(main())\npython\nimport asyncio\nfrom claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions\n\nasync def interruptible_task():\n    options = ClaudeAgentOptions(\n        allowed_tools=[\"Bash\"],\n        permission_mode=\"acceptEdits\"\n    )\n\nasync with ClaudeSDKClient(options=options) as client:\n        # Start a long-running task\n        await client.query(\"Count from 1 to 100 slowly\")\n\n# Let it run for a bit\n        await asyncio.sleep(2)\n\n# Interrupt the task\n        await client.interrupt()\n        print(\"Task interrupted!\")\n\n# Send a new command\n        await client.query(\"Just say hello instead\")\n\nasync for message in client.receive_response():\n            # Process the new response\n            pass\n\nasyncio.run(interruptible_task())\npython\nfrom claude_agent_sdk import (\n    ClaudeSDKClient,\n    ClaudeAgentOptions\n)\nfrom claude_agent_sdk.types import PermissionResultAllow, PermissionResultDeny\n\nasync def custom_permission_handler(\n    tool_name: str,\n    input_data: dict,\n    context: dict\n) -> PermissionResultAllow | PermissionResultDeny:\n    \"\"\"Custom logic for tool permissions.\"\"\"\n\n# Block writes to system directories\n    if tool_name == \"Write\" and input_data.get(\"file_path\", \"\").startswith(\"/system/\"):\n        return PermissionResultDeny(\n            message=\"System directory write not allowed\",\n            interrupt=True\n        )\n\n# Redirect sensitive file operations\n    if tool_name in [\"Write\", \"Edit\"] and \"config\" in input_data.get(\"file_path\", \"\"):\n        safe_path = f\"./sandbox/{input_data['file_path']}\"\n        return PermissionResultAllow(\n            updated_input={**input_data, \"file_path\": safe_path}\n        )\n\n# Allow everything else\n    return PermissionResultAllow(updated_input=input_data)\n\nasync def main():\n    options = ClaudeAgentOptions(\n        can_use_tool=custom_permission_handler,\n        allowed_tools=[\"Read\", \"Write\", \"Edit\"]\n    )\n\nasync with ClaudeSDKClient(options=options) as client:\n        await client.query(\"Update the system config file\")\n\nasync for message in client.receive_response():\n            # Will use sandbox path instead\n            print(message)\n\nasyncio.run(main())\npython\n@dataclass\nclass SdkMcpTool(Generic[T]):\n    name: str\n    description: str\n    input_schema: type[T] | dict[str, Any]\n    handler: Callable[[T], Awaitable[dict[str, Any]]]\npython\n@dataclass\nclass ClaudeAgentOptions:\n    allowed_tools: list[str] = field(default_factory=list)\n    system_prompt: str | SystemPromptPreset | None = None\n    mcp_servers: dict[str, McpServerConfig] | str | Path = field(default_factory=dict)\n    permission_mode: PermissionMode | None = None\n    continue_conversation: bool = False\n    resume: str | None = None\n    max_turns: int | None = None\n    disallowed_tools: list[str] = field(default_factory=list)\n    model: str | None = None\n    output_format: OutputFormat | None = None\n    permission_prompt_tool_name: str | None = None\n    cwd: str | Path | None = None\n    settings: str | None = None\n    add_dirs: list[str | Path] = field(default_factory=list)\n    env: dict[str, str] = field(default_factory=dict)\n    extra_args: dict[str, str | None] = field(default_factory=dict)\n    max_buffer_size: int | None = None\n    debug_stderr: Any = sys.stderr  # Deprecated\n    stderr: Callable[[str], None] | None = None\n    can_use_tool: CanUseTool | None = None\n    hooks: dict[HookEvent, list[HookMatcher]] | None = None\n    user: str | None = None\n    include_partial_messages: bool = False\n    fork_session: bool = False\n    agents: dict[str, AgentDefinition] | None = None\n    setting_sources: list[SettingSource] | None = None\npython\nclass OutputFormat(TypedDict):\n    type: Literal[\"json_schema\"]\n    schema: dict[str, Any]\npython\nclass SystemPromptPreset(TypedDict):\n    type: Literal[\"preset\"]\n    preset: Literal[\"claude_code\"]\n    append: NotRequired[str]\npython\nSettingSource = Literal[\"user\", \"project\", \"local\"]\npython",
  "code_samples": [
    {
      "code": "## Classes\n\n### `ClaudeSDKClient`\n\n**Maintains a conversation session across multiple exchanges.** This is the Python equivalent of how the TypeScript SDK's `query()` function works internally - it creates a client object that can continue conversations.\n\n#### Key Features\n\n- **Session Continuity**: Maintains conversation context across multiple `query()` calls\n- **Same Conversation**: Claude remembers previous messages in the session\n- **Interrupt Support**: Can stop Claude mid-execution\n- **Explicit Lifecycle**: You control when the session starts and ends\n- **Response-driven Flow**: Can react to responses and send follow-ups\n- **Custom Tools & Hooks**: Supports custom tools (created with `@tool` decorator) and hooks",
      "language": "unknown"
    },
    {
      "code": "#### Methods\n\n| Method                      | Description                                                         |\n| :-------------------------- | :------------------------------------------------------------------ |\n| `__init__(options)`         | Initialize the client with optional configuration                   |\n| `connect(prompt)`           | Connect to Claude with an optional initial prompt or message stream |\n| `query(prompt, session_id)` | Send a new request in streaming mode                                |\n| `receive_messages()`        | Receive all messages from Claude as an async iterator               |\n| `receive_response()`        | Receive messages until and including a ResultMessage                |\n| `interrupt()`               | Send interrupt signal (only works in streaming mode)                |\n| `rewind_files(user_message_uuid)` | Restore files to their state at the specified user message. Requires `enable_file_checkpointing=True`. See [File checkpointing](/docs/en/agent-sdk/file-checkpointing) |\n| `disconnect()`              | Disconnect from Claude                                              |\n\n#### Context Manager Support\n\nThe client can be used as an async context manager for automatic connection management:",
      "language": "unknown"
    },
    {
      "code": "> **Important:** When iterating over messages, avoid using `break` to exit early as this can cause asyncio cleanup issues. Instead, let the iteration complete naturally or use flags to track when you've found what you need.\n\n#### Example - Continuing a conversation",
      "language": "unknown"
    },
    {
      "code": "#### Example - Streaming input with ClaudeSDKClient",
      "language": "unknown"
    },
    {
      "code": "#### Example - Using interrupts",
      "language": "unknown"
    },
    {
      "code": "#### Example - Advanced permission control",
      "language": "unknown"
    },
    {
      "code": "## Types\n\n### `SdkMcpTool`\n\nDefinition for an SDK MCP tool created with the `@tool` decorator.",
      "language": "unknown"
    },
    {
      "code": "| Property       | Type                                       | Description                                |\n| :------------- | :----------------------------------------- | :----------------------------------------- |\n| `name`         | `str`                                      | Unique identifier for the tool             |\n| `description`  | `str`                                      | Human-readable description                 |\n| `input_schema` | `type[T] \\| dict[str, Any]`                | Schema for input validation                |\n| `handler`      | `Callable[[T], Awaitable[dict[str, Any]]]` | Async function that handles tool execution |\n\n### `ClaudeAgentOptions`\n\nConfiguration dataclass for Claude Code queries.",
      "language": "unknown"
    },
    {
      "code": "| Property                      | Type                                         | Default              | Description                                                                                                                                                                             |\n| :---------------------------- | :------------------------------------------- | :------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `allowed_tools`               | `list[str]`                                  | `[]`                 | List of allowed tool names                                                                                                                                                              |\n| `system_prompt`               | `str \\| SystemPromptPreset \\| None`          | `None`               | System prompt configuration. Pass a string for custom prompt, or use `{\"type\": \"preset\", \"preset\": \"claude_code\"}` for Claude Code's system prompt. Add `\"append\"` to extend the preset |\n| `mcp_servers`                 | `dict[str, McpServerConfig] \\| str \\| Path`  | `{}`                 | MCP server configurations or path to config file                                                                                                                                        |\n| `permission_mode`             | `PermissionMode \\| None`                     | `None`               | Permission mode for tool usage                                                                                                                                                          |\n| `continue_conversation`       | `bool`                                       | `False`              | Continue the most recent conversation                                                                                                                                                   |\n| `resume`                      | `str \\| None`                                | `None`               | Session ID to resume                                                                                                                                                                    |\n| `max_turns`                   | `int \\| None`                                | `None`               | Maximum conversation turns                                                                                                                                                              |\n| `disallowed_tools`            | `list[str]`                                  | `[]`                 | List of disallowed tool names                                                                                                                                                           |\n| `enable_file_checkpointing`   | `bool`                                       | `False`              | Enable file change tracking for rewinding. See [File checkpointing](/docs/en/agent-sdk/file-checkpointing)                                                                              |\n| `model`                       | `str \\| None`                                | `None`               | Claude model to use                                                                                                                                                                     |\n| `output_format`               | [`OutputFormat`](#outputformat) ` \\| None`   | `None`               | Define output format for agent results. See [Structured outputs](/docs/en/agent-sdk/structured-outputs) for details                                                                    |\n| `permission_prompt_tool_name` | `str \\| None`                                | `None`               | MCP tool name for permission prompts                                                                                                                                                    |\n| `cwd`                         | `str \\| Path \\| None`                        | `None`               | Current working directory                                                                                                                                                               |\n| `settings`                    | `str \\| None`                                | `None`               | Path to settings file                                                                                                                                                                   |\n| `add_dirs`                    | `list[str \\| Path]`                          | `[]`                 | Additional directories Claude can access                                                                                                                                                |\n| `env`                         | `dict[str, str]`                             | `{}`                 | Environment variables                                                                                                                                                                   |\n| `extra_args`                  | `dict[str, str \\| None]`                     | `{}`                 | Additional CLI arguments to pass directly to the CLI                                                                                                                                    |\n| `max_buffer_size`             | `int \\| None`                                | `None`               | Maximum bytes when buffering CLI stdout                                                                                                                                                 |\n| `debug_stderr`                | `Any`                                        | `sys.stderr`         | _Deprecated_ - File-like object for debug output. Use `stderr` callback instead                                                                                                         |\n| `stderr`                      | `Callable[[str], None] \\| None`              | `None`               | Callback function for stderr output from CLI                                                                                                                                            |\n| `can_use_tool`                | `CanUseTool \\| None`                         | `None`               | Tool permission callback function                                                                                                                                                       |\n| `hooks`                       | `dict[HookEvent, list[HookMatcher]] \\| None` | `None`               | Hook configurations for intercepting events                                                                                                                                             |\n| `user`                        | `str \\| None`                                | `None`               | User identifier                                                                                                                                                                         |\n| `include_partial_messages`    | `bool`                                       | `False`              | Include partial message streaming events                                                                                                                                                |\n| `fork_session`                | `bool`                                       | `False`              | When resuming with `resume`, fork to a new session ID instead of continuing the original session                                                                                        |\n| `agents`                      | `dict[str, AgentDefinition] \\| None`         | `None`               | Programmatically defined subagents                                                                                                                                                      |\n| `plugins`                     | `list[SdkPluginConfig]`                      | `[]`                 | Load custom plugins from local paths. See [Plugins](/docs/en/agent-sdk/plugins) for details                                                                                             |\n| `sandbox`                     | [`SandboxSettings`](#sandboxsettings) ` \\| None` | `None`              | Configure sandbox behavior programmatically. See [Sandbox settings](#sandboxsettings) for details                                        |\n| `setting_sources`             | `list[SettingSource] \\| None`                | `None` (no settings) | Control which filesystem settings to load. When omitted, no settings are loaded. **Note:** Must include `\"project\"` to load CLAUDE.md files                                             |\n\n### `OutputFormat`\n\nConfiguration for structured output validation.",
      "language": "unknown"
    },
    {
      "code": "| Field    | Required | Description                                    |\n| :------- | :------- | :--------------------------------------------- |\n| `type`   | Yes      | Must be `\"json_schema\"` for JSON Schema validation |\n| `schema` | Yes      | JSON Schema definition for output validation   |\n\n### `SystemPromptPreset`\n\nConfiguration for using Claude Code's preset system prompt with optional additions.",
      "language": "unknown"
    },
    {
      "code": "| Field    | Required | Description                                                   |\n| :------- | :------- | :------------------------------------------------------------ |\n| `type`   | Yes      | Must be `\"preset\"` to use a preset system prompt              |\n| `preset` | Yes      | Must be `\"claude_code\"` to use Claude Code's system prompt    |\n| `append` | No       | Additional instructions to append to the preset system prompt |\n\n### `SettingSource`\n\nControls which filesystem-based configuration sources the SDK loads settings from.",
      "language": "unknown"
    },
    {
      "code": "| Value       | Description                                  | Location                      |\n| :---------- | :------------------------------------------- | :---------------------------- |\n| `\"user\"`    | Global user settings                         | `~/.claude/settings.json`     |\n| `\"project\"` | Shared project settings (version controlled) | `.claude/settings.json`       |\n| `\"local\"`   | Local project settings (gitignored)          | `.claude/settings.local.json` |\n\n#### Default behavior\n\nWhen `setting_sources` is **omitted** or **`None`**, the SDK does **not** load any filesystem settings. This provides isolation for SDK applications.\n\n#### Why use setting_sources?\n\n**Load all filesystem settings (legacy behavior):**",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Classes",
      "id": "classes"
    },
    {
      "level": "h3",
      "text": "`ClaudeSDKClient`",
      "id": "`claudesdkclient`"
    },
    {
      "level": "h2",
      "text": "Types",
      "id": "types"
    },
    {
      "level": "h3",
      "text": "`SdkMcpTool`",
      "id": "`sdkmcptool`"
    },
    {
      "level": "h3",
      "text": "`ClaudeAgentOptions`",
      "id": "`claudeagentoptions`"
    },
    {
      "level": "h3",
      "text": "`OutputFormat`",
      "id": "`outputformat`"
    },
    {
      "level": "h3",
      "text": "`SystemPromptPreset`",
      "id": "`systempromptpreset`"
    },
    {
      "level": "h3",
      "text": "`SettingSource`",
      "id": "`settingsource`"
    }
  ],
  "url": "llms-txt#use-with-claude",
  "links": []
}