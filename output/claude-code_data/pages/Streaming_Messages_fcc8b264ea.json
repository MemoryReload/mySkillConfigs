{
  "title": "Streaming Messages",
  "content": "When creating a Message, you can set `\"stream\": true` to incrementally stream the response using [server-sent events](https://developer.mozilla.org/en-US/Web/API/Server-sent%5Fevents/Using%5Fserver-sent%5Fevents) (SSE).\n\n## Streaming with SDKs\n\nOur [Python](https://github.com/anthropics/anthropic-sdk-python) and [TypeScript](https://github.com/anthropics/anthropic-sdk-typescript) SDKs offer multiple ways of streaming. The Python SDK allows both sync and async streams. See the documentation in each SDK for details.\n\nEach server-sent event includes a named event type and associated JSON data. Each event will use an SSE event name (e.g. `event: message_stop`), and include the matching event `type` in its data.\n\nEach stream uses the following event flow:\n\n1. `message_start`: contains a `Message` object with empty `content`.\n2. A series of content blocks, each of which have a `content_block_start`, one or more `content_block_delta` events, and a `content_block_stop` event. Each content block will have an `index` that corresponds to its index in the final Message `content` array.\n3. One or more `message_delta` events, indicating top-level changes to the final `Message` object.\n4. A final `message_stop` event.\n\n<Warning>\n  The token counts shown in the `usage` field of the `message_delta` event are *cumulative*.\n  </Warning>\n\nEvent streams may also include any number of `ping` events.\n\nWe may occasionally send [errors](/docs/en/api/errors) in the event stream. For example, during periods of high usage, you may receive an `overloaded_error`, which would normally correspond to an HTTP 529 in a non-streaming context:\n\nIn accordance with our [versioning policy](/docs/en/api/versioning), we may add new event types, and your code should handle unknown event types gracefully.\n\n## Content block delta types\n\nEach `content_block_delta` event contains a `delta` of a type that updates the `content` block at a given `index`.\n\nA `text` content block delta looks like:\n\nThe deltas for `tool_use` content blocks correspond to updates for the `input` field of the block. To support maximum granularity, the deltas are _partial JSON strings_, whereas the final `tool_use.input` is always an _object_.\n\nYou can accumulate the string deltas and parse the JSON once you receive a `content_block_stop` event, by using a library like [Pydantic](https://docs.pydantic.dev/latest/concepts/json/#partial-json-parsing) to do partial JSON parsing, or by using our [SDKs](/docs/en/api/client-sdks), which provide helpers to access parsed incremental values.\n\nA `tool_use` content block delta looks like:\n\nNote: Our current models only support emitting one complete key and value property from `input` at a time. As such, when using tools, there may be delays between streaming events while the model is working. Once an `input` key and value are accumulated, we emit them as multiple `content_block_delta` events with chunked partial json so that the format can automatically support finer granularity in future models.\n\nWhen using [extended thinking](/docs/en/build-with-claude/extended-thinking#streaming-thinking) with streaming enabled, you'll receive thinking content via `thinking_delta` events. These deltas correspond to the `thinking` field of the `thinking` content blocks.\n\nFor thinking content, a special `signature_delta` event is sent just before the `content_block_stop` event. This signature is used to verify the integrity of the thinking block.\n\nA typical thinking delta looks like:\n\nThe signature delta looks like:\n\n## Full HTTP Stream response\n\nWe strongly recommend that you use our [client SDKs](/docs/en/api/client-sdks) when using streaming mode. However, if you are building a direct API integration, you will need to handle these events yourself.\n\nA stream response is comprised of:\n1. A `message_start` event\n2. Potentially multiple content blocks, each of which contains:\n    - A `content_block_start` event\n    - Potentially multiple `content_block_delta` events\n    - A `content_block_stop` event\n3. A `message_delta` event\n4. A `message_stop` event\n\nThere may be `ping` events dispersed throughout the response as well. See [Event types](#event-types) for more details on the format.\n\n### Basic streaming request\n\n### Streaming request with tool use\n\n<Tip>\nTool use now supports fine-grained streaming for parameter values as a beta feature. For more details, see [Fine-grained tool streaming](/docs/en/agents-and-tools/tool-use/fine-grained-tool-streaming).\n</Tip>\n\nIn this request, we ask Claude to use a tool to tell us the weather.\n\n### Streaming request with extended thinking\n\nIn this request, we enable extended thinking with streaming to see Claude's step-by-step reasoning.\n\n### Streaming request with web search tool use\n\nIn this request, we ask Claude to search the web for current weather information.\n\nWhen a streaming request is interrupted due to network issues, timeouts, or other errors, you can recover by resuming from where the stream was interrupted. This approach saves you from re-processing the entire response.\n\nThe basic recovery strategy involves:\n\n1. **Capture the partial response**: Save all content that was successfully received before the error occurred\n2. **Construct a continuation request**: Create a new API request that includes the partial assistant response as the beginning of a new assistant message\n3. **Resume streaming**: Continue receiving the rest of the response from where it was interrupted\n\n### Error recovery best practices\n\n1. **Use SDK features**: Leverage the SDK's built-in message accumulation and error handling capabilities\n2. **Handle content types**: Be aware that messages can contain multiple content blocks (`text`, `tool_use`, `thinking`). Tool use and extended thinking blocks cannot be partially recovered. You can resume streaming from the most recent text block.",
  "code_samples": [
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\n## Event types\n\nEach server-sent event includes a named event type and associated JSON data. Each event will use an SSE event name (e.g. `event: message_stop`), and include the matching event `type` in its data.\n\nEach stream uses the following event flow:\n\n1. `message_start`: contains a `Message` object with empty `content`.\n2. A series of content blocks, each of which have a `content_block_start`, one or more `content_block_delta` events, and a `content_block_stop` event. Each content block will have an `index` that corresponds to its index in the final Message `content` array.\n3. One or more `message_delta` events, indicating top-level changes to the final `Message` object.\n4. A final `message_stop` event.\n\n  <Warning>\n  The token counts shown in the `usage` field of the `message_delta` event are *cumulative*.\n  </Warning>\n\n### Ping events\n\nEvent streams may also include any number of `ping` events.\n\n### Error events\n\nWe may occasionally send [errors](/docs/en/api/errors) in the event stream. For example, during periods of high usage, you may receive an `overloaded_error`, which would normally correspond to an HTTP 529 in a non-streaming context:",
      "language": "unknown"
    },
    {
      "code": "### Other events\n\nIn accordance with our [versioning policy](/docs/en/api/versioning), we may add new event types, and your code should handle unknown event types gracefully.\n\n## Content block delta types\n\nEach `content_block_delta` event contains a `delta` of a type that updates the `content` block at a given `index`.\n\n### Text delta\n\nA `text` content block delta looks like:",
      "language": "unknown"
    },
    {
      "code": "### Input JSON delta\n\nThe deltas for `tool_use` content blocks correspond to updates for the `input` field of the block. To support maximum granularity, the deltas are _partial JSON strings_, whereas the final `tool_use.input` is always an _object_.\n\nYou can accumulate the string deltas and parse the JSON once you receive a `content_block_stop` event, by using a library like [Pydantic](https://docs.pydantic.dev/latest/concepts/json/#partial-json-parsing) to do partial JSON parsing, or by using our [SDKs](/docs/en/api/client-sdks), which provide helpers to access parsed incremental values.\n\nA `tool_use` content block delta looks like:",
      "language": "unknown"
    },
    {
      "code": "Note: Our current models only support emitting one complete key and value property from `input` at a time. As such, when using tools, there may be delays between streaming events while the model is working. Once an `input` key and value are accumulated, we emit them as multiple `content_block_delta` events with chunked partial json so that the format can automatically support finer granularity in future models.\n\n### Thinking delta\n\nWhen using [extended thinking](/docs/en/build-with-claude/extended-thinking#streaming-thinking) with streaming enabled, you'll receive thinking content via `thinking_delta` events. These deltas correspond to the `thinking` field of the `thinking` content blocks.\n\nFor thinking content, a special `signature_delta` event is sent just before the `content_block_stop` event. This signature is used to verify the integrity of the thinking block.\n\nA typical thinking delta looks like:",
      "language": "unknown"
    },
    {
      "code": "The signature delta looks like:",
      "language": "unknown"
    },
    {
      "code": "## Full HTTP Stream response\n\nWe strongly recommend that you use our [client SDKs](/docs/en/api/client-sdks) when using streaming mode. However, if you are building a direct API integration, you will need to handle these events yourself.\n\nA stream response is comprised of:\n1. A `message_start` event\n2. Potentially multiple content blocks, each of which contains:\n    - A `content_block_start` event\n    - Potentially multiple `content_block_delta` events\n    - A `content_block_stop` event\n3. A `message_delta` event\n4. A `message_stop` event\n\nThere may be `ping` events dispersed throughout the response as well. See [Event types](#event-types) for more details on the format.\n\n### Basic streaming request\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "### Streaming request with tool use\n\n<Tip>\nTool use now supports fine-grained streaming for parameter values as a beta feature. For more details, see [Fine-grained tool streaming](/docs/en/agents-and-tools/tool-use/fine-grained-tool-streaming).\n</Tip>\n\nIn this request, we ask Claude to use a tool to tell us the weather.\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "### Streaming request with extended thinking\n\nIn this request, we enable extended thinking with streaming to see Claude's step-by-step reasoning.\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "### Streaming request with web search tool use\n\nIn this request, we ask Claude to search the web for current weather information.\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Streaming with SDKs",
      "id": "streaming-with-sdks"
    },
    {
      "level": "h2",
      "text": "Event types",
      "id": "event-types"
    },
    {
      "level": "h3",
      "text": "Ping events",
      "id": "ping-events"
    },
    {
      "level": "h3",
      "text": "Error events",
      "id": "error-events"
    },
    {
      "level": "h3",
      "text": "Other events",
      "id": "other-events"
    },
    {
      "level": "h2",
      "text": "Content block delta types",
      "id": "content-block-delta-types"
    },
    {
      "level": "h3",
      "text": "Text delta",
      "id": "text-delta"
    },
    {
      "level": "h3",
      "text": "Input JSON delta",
      "id": "input-json-delta"
    },
    {
      "level": "h3",
      "text": "Thinking delta",
      "id": "thinking-delta"
    },
    {
      "level": "h2",
      "text": "Full HTTP Stream response",
      "id": "full-http-stream-response"
    },
    {
      "level": "h3",
      "text": "Basic streaming request",
      "id": "basic-streaming-request"
    },
    {
      "level": "h3",
      "text": "Streaming request with tool use",
      "id": "streaming-request-with-tool-use"
    },
    {
      "level": "h3",
      "text": "Streaming request with extended thinking",
      "id": "streaming-request-with-extended-thinking"
    },
    {
      "level": "h3",
      "text": "Streaming request with web search tool use",
      "id": "streaming-request-with-web-search-tool-use"
    },
    {
      "level": "h2",
      "text": "Error recovery",
      "id": "error-recovery"
    },
    {
      "level": "h3",
      "text": "Error recovery best practices",
      "id": "error-recovery-best-practices"
    }
  ],
  "url": "llms-txt#streaming-messages",
  "links": []
}