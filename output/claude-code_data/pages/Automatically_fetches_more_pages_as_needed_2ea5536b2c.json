{
  "title": "Automatically fetches more pages as needed.",
  "content": "for message_batch in client.messages.batches.list(\n    limit=20\n):\n    print(message_batch)\ntypescript TypeScript\nimport Anthropic from '@anthropic-ai/sdk';\n\nconst anthropic = new Anthropic();\n\n// Automatically fetches more pages as needed.\nfor await (const messageBatch of anthropic.messages.batches.list({\n  limit: 20\n})) {\n  console.log(messageBatch);\n}\nbash Shell\n#!/bin/sh\n\nif ! command -v jq &> /dev/null; then\n    echo \"Error: This script requires jq. Please install it first.\"\n    exit 1\nfi\n\nBASE_URL=\"https://api.anthropic.com/v1/messages/batches\"\n\nhas_more=true\nafter_id=\"\"\n\nwhile [ \"$has_more\" = true ]; do\n    # Construct URL with after_id if it exists\n    if [ -n \"$after_id\" ]; then\n        url=\"${BASE_URL}?limit=20&after_id=${after_id}\"\n    else\n        url=\"$BASE_URL?limit=20\"\n    fi\n\nresponse=$(curl -s \"$url\" \\\n              --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n              --header \"anthropic-version: 2023-06-01\")\n\n# Extract values using jq\n    has_more=$(echo \"$response\" | jq -r '.has_more')\n    after_id=$(echo \"$response\" | jq -r '.last_id')\n\n# Process and print each entry in the data array\n    echo \"$response\" | jq -c '.data[]' | while read -r entry; do\n        echo \"$entry\" | jq '.'\n    done\ndone\njava Java\nimport com.anthropic.client.AnthropicClient;\nimport com.anthropic.client.okhttp.AnthropicOkHttpClient;\nimport com.anthropic.models.messages.batches.*;\n\npublic class BatchListExample {\n    public static void main(String[] args) {\n        AnthropicClient client = AnthropicOkHttpClient.fromEnv();\n\n// Automatically fetches more pages as needed\n        for (MessageBatch messageBatch : client.messages().batches().list(\n                BatchListParams.builder()\n                        .limit(20)\n                        .build()\n        )) {\n            System.out.println(messageBatch);\n        }\n    }\n}\nbash Shell\n#!/bin/sh\ncurl \"https://api.anthropic.com/v1/messages/batches/msgbatch_01HkcTjaV5uDC8jWR4ZsDV8d\" \\\n  --header \"anthropic-version: 2023-06-01\" \\\n  --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n  | grep -o '\"results_url\":[[:space:]]*\"[^\"]*\"' \\\n  | cut -d'\"' -f4 \\\n  | while read -r url; do\n    curl -s \"$url\" \\\n      --header \"anthropic-version: 2023-06-01\" \\\n      --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n      | sed 's/}{/}\\n{/g' \\\n      | while IFS= read -r line\n    do\n      result_type=$(echo \"$line\" | sed -n 's/.*\"result\":[[:space:]]*{[[:space:]]*\"type\":[[:space:]]*\"\\([^\"]*\\)\".*/\\1/p')\n      custom_id=$(echo \"$line\" | sed -n 's/.*\"custom_id\":[[:space:]]*\"\\([^\"]*\\)\".*/\\1/p')\n      error_type=$(echo \"$line\" | sed -n 's/.*\"error\":[[:space:]]*{[[:space:]]*\"type\":[[:space:]]*\"\\([^\"]*\\)\".*/\\1/p')\n\ncase \"$result_type\" in\n        \"succeeded\")\n          echo \"Success! $custom_id\"\n          ;;\n        \"errored\")\n          if [ \"$error_type\" = \"invalid_request\" ]; then\n            # Request body must be fixed before re-sending request\n            echo \"Validation error: $custom_id\"\n          else\n            # Request can be retried directly\n            echo \"Server error: $custom_id\"\n          fi\n          ;;\n        \"expired\")\n          echo \"Expired: $line\"\n          ;;\n      esac\n    done\n  done\n\npython Python\nimport anthropic\n\nclient = anthropic.Anthropic()",
  "code_samples": [
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\n### Retrieving batch results\n\nOnce batch processing has ended, each Messages request in the batch will have a result. There are 4 result types:\n\n| Result Type | Description |\n|-------------|-------------|\n| `succeeded` | Request was successful. Includes the message result. |\n| `errored`   | Request encountered an error and a message was not created. Possible errors include invalid requests and internal server errors. You will not be billed for these requests. |\n| `canceled`  | User canceled the batch before this request could be sent to the model. You will not be billed for these requests. |\n| `expired`   | Batch reached its 24 hour expiration before this request could be sent to the model. You will not be billed for these requests. |\n\nYou will see an overview of your results with the batch's `request_counts`, which shows how many requests reached each of these four states.\n\nResults of the batch are available for download at the `results_url` property on the Message Batch, and if the organization permission allows, in the Console. Because of the potentially large size of the results, it's recommended to [stream results](/docs/en/api/retrieving-message-batch-results) back rather than download them all at once.\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": "Retrieving batch results",
      "id": "retrieving-batch-results"
    }
  ],
  "url": "llms-txt#automatically-fetches-more-pages-as-needed.",
  "links": []
}